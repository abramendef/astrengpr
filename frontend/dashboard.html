<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard - Astren</title>
    <meta name="description" content="Panel principal de Astren - Gestiona tus áreas personales y grupos colaborativos con reputación por estrellas.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Flatpickr DateTime Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css?v=6">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/dashboard.css?v=1055">
    <link rel="stylesheet" href="css/groups.css?v=12">
    <link rel="stylesheet" href="css/areas.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="css/tasks.css">
    <link rel="stylesheet" href="css/counters-perfect.css?v=999">
</head>
<body class="dashboard-body">
    <div class="dashboard">
        <!-- El sidebar será inyectado dinámicamente por sidebar-new.js -->

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- Header -->
            <header class="dashboard__header">
                <div class="header__container">
                    <div class="header__left">
                        <button class="mobile-menu-btn" id="mobileMenuBtn">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 class="header__title">Panel Principal</h1>
                    </div>

                    <div class="header__right">
                        <div class="header__search">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Buscar tareas, equipos..." class="search__input">
                        </div>

                        <button class="header__notification">
                            <i class="fas fa-bell"></i>
                            <span class="notification__badge">3</span>
                        </button>

                        <button class="header__button" id="profileBtn" aria-label="Perfil" style="background: #3366FF; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-left: 10px;">
                            <i class="fas fa-user" style="font-size: 18px;"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Contenido del dashboard -->
            <div class="dashboard__content">
                <!-- Tarjetas de estadísticas -->
                <section class="stats-grid tasks-stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon stat-icon--today">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statToday">0</span>
                            <span class="stat-label">Hoy</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon stat-icon--pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statPending">0</span>
                            <span class="stat-label">Pendientes</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon stat-icon--completed">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statCompleted">0</span>
                            <span class="stat-label">Completadas</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon stat-icon--overdue">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-value" id="statOverdue">0</span>
                            <span class="stat-label">Vencidas</span>
                        </div>
                    </div>
                </section>

                <!-- NUEVO GRID: Tareas Hoy y Progreso de Reputación -->
                <div class="dashboard-row-grid">
                  <section class="dashboard-card" style="grid-column: 1;">
                      <div class="card__header card__header--compact">
                          <h2 class="card__title">
                              <i class="fas fa-calendar-day"></i>
                              Tareas Hoy
                              <span class="task-counter" id="todayTasksCounter">0</span>
                          </h2>
                          <div class="card__actions">
                              <!-- Botón rápido para crear tarea -->
                              <button class="card__action-btn" id="quickAddTaskBtn" title="Crear tarea rápida">
                                  <i class="fas fa-plus"></i>
                                  Nueva tarea
                              </button>
                              <button class="card__action-btn" onclick="window.location.href='tasks.html'" title="Ver todas las tareas">
                                  <i class="fas fa-external-link-alt"></i>
                                  Ver todas
                              </button>
                          </div>
                      </div>
                      <div class="card__content">
                          <div class="dashboard-task-list-scroll">
                              <div class="dashboard-task-list" id="dashboardTodayTasks"></div>
                          </div>
                      </div>
                  </section><section class="dashboard-card" style="grid-column: 2;">
                      <div class="card__header">
                          <h2 class="card__title">
                              <i class="fas fa-chart-line"></i>
                              Progreso de Reputación
                          </h2>
                      </div>
                      <div class="card__content">
                          <div class="reputation-summary">
                              <div class="reputation-score">
                                  <div class="score-stars">
                                      <i class="fas fa-star"></i>
                                      <i class="fas fa-star"></i>
                                      <i class="fas fa-star"></i>
                                      <i class="fas fa-star"></i>
                                      <i class="fas fa-star-half-alt"></i>
                                  </div>
                                  <span class="score-value">4.5</span>
                                  <span class="score-label">Reputación General</span>
                              </div>
                              <div class="reputation-change">
                                  <i class="fas fa-arrow-up"></i>
                                  <span>+0.3 este mes</span>
                              </div>
                          </div>
                          <div class="chart-container">
                              <canvas id="reputationChart"></canvas>
                          </div>
                      </div>
                  </section>
                </div>

                <!-- Sección de Áreas -->
                <section class="dashboard-card dashboard-card--full">
                    <div class="card__header">
                        <h2 class="card__title">
                            <i class="fas fa-layer-group"></i>
                            Mis Áreas
                        </h2>
                    </div>
                    <div class="card__content">
                        <div class="areas-container" id="areasGrid">
                            <!-- Las áreas se cargarán dinámicamente aquí -->
                        </div>
                        <button class="scroll-btn scroll-btn--left" id="areasScrollLeft" style="display: none;">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="scroll-btn scroll-btn--right" id="areasScrollRight" style="display: none;">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </section>

                <!-- Sección de Grupos -->
                <section class="dashboard-card dashboard-card--full">
                    <div class="card__header">
                        <h2 class="card__title">
                            <i class="fas fa-users"></i>
                            Mis Grupos Colaborativos
                        </h2>
                    </div>
                    <div class="card__content">
                        <div class="groups-container" id="groupsGrid">
                            <!-- Los grupos se cargarán dinámicamente aquí -->
                        </div>
                        <button class="scroll-btn scroll-btn--left" id="groupsScrollLeft" style="display: none;">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="scroll-btn scroll-btn--right" id="groupsScrollRight" style="display: none;">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- New Task Modal -->
    <div class="modal" id="newTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nueva Tarea</h2>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="task-form" id="newTaskForm">
                <div class="form-group">
                    <label for="taskTitle">Título de la tarea</label>
                    <input type="text" id="taskTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Descripción</label>
                    <textarea id="taskDescription" name="description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskArea">Área</label>
                        <select id="taskArea" name="area">
                            <option value="">Seleccionar área</option>
                            <option value="personal">Personal</option>
                            <option value="work">Trabajo</option>
                            <option value="school">Escuela</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskDueDate">Fecha de vencimiento</label>
                    <input type="datetime-local" id="taskDueDate" name="dueDate" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="button button--ghost" id="cancelTask">Cancelar</button>
                    <button type="submit" class="button button--primary">Crear Tarea</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal" id="editTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Tarea</h2>
                <button class="modal-close" id="closeEditModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="task-form" id="editTaskForm">
                <div class="form-group">
                    <label for="editTaskTitle">Título de la tarea</label>
                    <input type="text" id="editTaskTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="editTaskDescription">Descripción</label>
                    <textarea id="editTaskDescription" name="description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editTaskArea">Área</label>
                        <select id="editTaskArea" name="area">
                            <option value="">Seleccionar área</option>
                            <option value="personal">Personal</option>
                            <option value="work">Trabajo</option>
                            <option value="school">Escuela</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editTaskDueDate">Fecha de vencimiento</label>
                    <input type="datetime-local" id="editTaskDueDate" name="dueDate" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="button button--ghost" id="cancelEditTask">Cancelar</button>
                    <button type="submit" class="button button--primary">Actualizar Tarea</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar tarea -->
    <div class="modal" id="deleteTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>¿Eliminar tarea?</h2>
                <button class="modal-close" id="closeDeleteModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que quieres eliminar esta tarea? Esta acción no se puede deshacer.</p>
            </div>
            <div class="form-actions">
                <button type="button" class="button button--ghost" id="cancelDeleteTask">Cancelar</button>
                <button type="button" class="button button--danger" id="confirmDeleteTask">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/sidebar-new.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/dashboard.js?v=16"></script>
    <script src="js/header-buttons.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/notifications.js"></script>
</body>
</html>