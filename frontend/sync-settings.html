<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sincronización - Astren</title>
    <meta name="description" content="Configura la sincronización de tareas con servicios externos en Astren.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/sync-settings.css">
</head>
<body class="dashboard-body">
    <div class="dashboard">
        <!-- El sidebar será inyectado dinámicamente por sidebar-new.js -->

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="dashboard__header">
                <div class="header__container">
                    <div class="header__left">
                        <button class="mobile-menu-btn" id="mobileMenuBtn">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 class="header__title">Sincronización</h1>
                    </div>

                    <div class="header__right">
                        <div class="header__search">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Buscar configuraciones..." class="search__input">
                        </div>

                        <button class="header__notification">
                            <i class="fas fa-bell"></i>
                            <span class="notification__badge">3</span>
                        </button>

                        <div class="header__profile">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%233366FF'%3E%3Cpath fill-rule='evenodd' d='M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z' clip-rule='evenodd' /%3E%3C/svg%3E" alt="Avatar">
                        </div>
                    </div>
                </div>
            </header>

            <!-- Sync Settings Content -->
            <div class="dashboard__content">
                <!-- Sync Services Section -->
                <section class="sync-services">
                    <h2 class="section-title">
                        <i class="fas fa-sync-alt"></i>
                        Servicios de Sincronización
                    </h2>
                    
                    <div class="services-grid">
                        <!-- Microsoft To Do -->
                        <div class="service-card" id="microsoftCard">
                            <div class="service-header">
                                <div class="service-icon">
                                    <i class="fab fa-microsoft"></i>
                                </div>
                                <div class="service-info">
                                    <h3>Microsoft To Do</h3>
                                    <p>Sincroniza tus tareas con Microsoft To Do</p>
                                </div>
                                <div class="service-status" id="microsoftStatus">
                                    <span class="status-badge status-disconnected">Desconectado</span>
                                </div>
                            </div>
                            <div class="service-actions">
                                <button class="button button--primary" id="connectMicrosoft">
                                    <i class="fas fa-link"></i>
                                    Conectar
                                </button>
                                <button class="button button--ghost" id="syncMicrosoft" style="display: none;">
                                    <i class="fas fa-sync"></i>
                                    Sincronizar
                                </button>
                            </div>
                        </div>

                        <!-- iCloud Reminders -->
                        <div class="service-card" id="icloudCard">
                            <div class="service-header">
                                <div class="service-icon">
                                    <i class="fab fa-apple"></i>
                                </div>
                                <div class="service-info">
                                    <h3>iCloud Reminders</h3>
                                    <p>Sincroniza con los recordatorios de iCloud</p>
                                </div>
                                <div class="service-status" id="icloudStatus">
                                    <span class="status-badge status-disconnected">Desconectado</span>
                                </div>
                            </div>
                            <div class="service-actions">
                                <button class="button button--primary" id="connectICloud">
                                    <i class="fas fa-link"></i>
                                    Conectar
                                </button>
                                <button class="button button--ghost" id="syncICloud" style="display: none;">
                                    <i class="fas fa-sync"></i>
                                    Sincronizar
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sync Configuration -->
                <section class="sync-config">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Configuración de Sincronización
                    </h2>
                    
                    <div class="config-grid">
                        <div class="config-item">
                            <label class="config-label">
                                <input type="checkbox" id="autoSync" checked>
                                <span class="checkmark"></span>
                                Sincronización automática
                            </label>
                            <p class="config-description">Sincroniza automáticamente las tareas cada 30 minutos</p>
                        </div>
                        
                        <div class="config-item">
                            <label for="syncInterval" class="config-label">Intervalo de sincronización</label>
                            <select id="syncInterval" class="config-select">
                                <option value="15">15 minutos</option>
                                <option value="30" selected>30 minutos</option>
                                <option value="60">1 hora</option>
                                <option value="120">2 horas</option>
                            </select>
                        </div>
                        
                        <div class="config-item">
                            <label class="config-label">
                                <input type="checkbox" id="bidirectionalSync" checked>
                                <span class="checkmark"></span>
                                Sincronización bidireccional
                            </label>
                            <p class="config-description">Permite que los cambios se sincronicen en ambas direcciones</p>
                        </div>
                    </div>
                </section>

                <!-- Sync History -->
                <section class="sync-history">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Historial de Sincronización
                    </h2>
                    
                    <div class="history-list" id="syncHistory">
                        <div class="history-item">
                            <div class="history-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="history-content">
                                <h4>Sincronización automática</h4>
                                <p>5 tareas sincronizadas con Microsoft To Do</p>
                                <span class="history-time">Hace 2 minutos</span>
                            </div>
                            <div class="history-status">
                                <span class="status-badge status-success">Exitoso</span>
                            </div>
                        </div>
                        
                        <div class="history-item">
                            <div class="history-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="history-content">
                                <h4>Error de sincronización</h4>
                                <p>No se pudo conectar con iCloud Reminders</p>
                                <span class="history-time">Hace 15 minutos</span>
                            </div>
                            <div class="history-status">
                                <span class="status-badge status-error">Error</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Microsoft Connection Modal -->
    <div class="modal" id="microsoftModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conectar con Microsoft To Do</h2>
                <button class="modal-close" id="closeMicrosoftModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Para conectar con Microsoft To Do, necesitas autorizar a Astren para acceder a tus tareas.</p>
                <div class="auth-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <p>Haz clic en "Autorizar" para abrir la página de Microsoft</p>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <p>Inicia sesión con tu cuenta de Microsoft</p>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <p>Autoriza a Astren para acceder a tus tareas</p>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="button button--ghost" id="cancelMicrosoft">Cancelar</button>
                <button type="button" class="button button--primary" id="authorizeMicrosoft">
                    <i class="fab fa-microsoft"></i>
                    Autorizar
                </button>
            </div>
        </div>
    </div>

    <!-- iCloud Connection Modal -->
    <div class="modal" id="icloudModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conectar con iCloud Reminders</h2>
                <button class="modal-close" id="closeICloudModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Para conectar con iCloud Reminders, necesitas proporcionar tu Apple ID y una contraseña específica de app.</p>
                
                <div class="help-section">
                    <div class="help-header">
                        <i class="fas fa-question-circle"></i>
                        <h4>¿Necesitas ayuda?</h4>
                    </div>
                    <div class="help-links">
                        <a href="ICLOUD_SETUP.md" target="_blank" class="help-link">
                            <i class="fas fa-book"></i>
                            Guía completa de configuración
                        </a>
                        <a href="https://support.apple.com/es-es/HT204397" target="_blank" class="help-link">
                            <i class="fab fa-apple"></i>
                            Generar contraseña específica de app
                        </a>
                        <button type="button" class="help-link" id="testICloudConnection">
                            <i class="fas fa-vial"></i>
                            Probar conexión
                        </button>
                    </div>
                </div>
                
                <form id="icloudForm" class="auth-form">
                    <div class="form-group">
                        <label for="appleId">Apple ID</label>
                        <input type="email" id="appleId" name="appleId" required placeholder="tu.email@icloud.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="appPassword">Contraseña específica de app</label>
                        <input type="password" id="appPassword" name="appPassword" required placeholder="Contraseña de app">
                        <small class="form-help">
                            Debe tener al menos 10 caracteres y permisos para CalDAV
                        </small>
                    </div>
                </form>
                
                <div class="auth-note">
                    <i class="fas fa-info-circle"></i>
                    <p>Tu contraseña específica de app se almacena de forma segura y solo se usa para sincronizar tus recordatorios.</p>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="button button--ghost" id="cancelICloud">Cancelar</button>
                <button type="button" class="button button--primary" id="connectICloudBtn">
                    <i class="fab fa-apple"></i>
                    Conectar
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/sidebar-new.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/sync-settings.js"></script>
    <script src="js/header-buttons.js"></script>
</body>
</html> 